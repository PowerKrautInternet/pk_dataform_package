
/*config*/
let pk = require("../../sources")
let ref = pk.ref
let query = `
SELECT
  JSON_VALUE(PAYLOAD, '$.AFLEVERINGID') AS AFLEVERINGID,
  JSON_VALUE(PAYLOAD, '$.TRAJECTID') AS TRAJECTID,
  JSON_VALUE(PAYLOAD, '$.AFLEVERINGSTATUSID') AS AFLEVERINGSTATUSID,
  JSON_VALUE(PAYLOAD, '$.GOEDGEKEURDDOOR') AS GOEDGEKEURDDOOR,
  JSON_VALUE(PAYLOAD, '$.GOEDGEKEURDDATUM') AS GOEDGEKEURDDATUM,
  JSON_VALUE(PAYLOAD, '$.ORDERDATUM') AS ORDERDATUM,
  JSON_VALUE(PAYLOAD, '$.ORDERDATUMIMPORTEUR') AS ORDERDATUMIMPORTEUR,
  JSON_VALUE(PAYLOAD, '$.AUTOBINNENDATUM') AS AUTOBINNENDATUM, -- belangrijk!
  JSON_VALUE(PAYLOAD, '$.AFSPRAAKAFLEVERDATUMSTART') AS AFSPRAAKAFLEVERDATUMSTART, -- belangrijk!
  JSON_VALUE(PAYLOAD, '$.AFSPRAAKAFLEVERDATUMEIND') AS AFSPRAAKAFLEVERDATUMEIND,
  JSON_VALUE(PAYLOAD, '$.AUTOAFGELEVERDDATUM') AS AUTOAFGELEVERDDATUM,
  JSON_VALUE(PAYLOAD, '$.AKDKLANT') AS AKDKLANT,
  JSON_VALUE(PAYLOAD, '$.AKDORIGINEEL') AS AKDORIGINEEL,
  JSON_VALUE(PAYLOAD, '$.AKDHUIDIG') AS AKDHUIDIG,
  JSON_VALUE(PAYLOAD, '$.DEALERNUMMER') AS DEALERNUMMER,
  JSON_VALUE(PAYLOAD, '$.ORDERNUMMER') AS ORDERNUMMER,
  JSON_VALUE(PAYLOAD, '$.BESTELNUMMER') AS BESTELNUMMER,
  JSON_VALUE(PAYLOAD, '$.CHASSISNUMMER') AS CHASSISNUMMER,
  JSON_VALUE(PAYLOAD, '$.KENTEKEN') AS KENTEKEN,
  JSON_VALUE(PAYLOAD, '$.SOORTKENTEKENID') AS SOORTKENTEKENID,
  JSON_VALUE(PAYLOAD, '$.SOORTBRANDSTOFID') AS SOORTBRANDSTOFID,
  JSON_VALUE(PAYLOAD, '$.DATUMDEEL1') AS DATUMDEEL1,
  JSON_VALUE(PAYLOAD, '$.ISVOORRAAD') AS ISVOORRAAD,
  JSON_VALUE(PAYLOAD, '$.BESTEMMING') AS BESTEMMING,
  JSON_VALUE(PAYLOAD, '$.STATUSVOORTGANG') AS STATUSVOORTGANG,
  JSON_VALUE(PAYLOAD, '$.STATUSFLEXIBILITEIT') AS STATUSFLEXIBILITEIT,
  JSON_VALUE(PAYLOAD, '$.CREATIEDATUM') AS CREATIEDATUM,
  JSON_VALUE(PAYLOAD, '$.PURGEDATUM') AS PURGEDATUM,
  JSON_VALUE(PAYLOAD, '$.MODELSCL') AS MODELSCL,
  JSON_VALUE(PAYLOAD, '$.VERSIESCL') AS VERSIESCL,
  JSON_VALUE(PAYLOAD, '$.EXTKLEURCODE') AS EXTKLEURCODE,
  JSON_VALUE(PAYLOAD, '$.AFKORTINGKLEUR') AS AFKORTINGKLEUR,
  JSON_VALUE(PAYLOAD, '$.DETAILKLEURCODE') AS DETAILKLEURCODE,
  JSON_VALUE(PAYLOAD, '$.INTKLEURCODE') AS INTKLEURCODE,
  JSON_VALUE(PAYLOAD, '$.AANTALOPTIESSCL1') AS AANTALOPTIESSCL1,
  JSON_VALUE(PAYLOAD, '$.OPTIESSCL1') AS OPTIESSCL1,
  JSON_VALUE(PAYLOAD, '$.AANTALOPTIESSCL2') AS AANTALOPTIESSCL2,
  JSON_VALUE(PAYLOAD, '$.OPTIESSCL2') AS OPTIESSCL2,
  JSON_VALUE(PAYLOAD, '$.TYPEAFTERSALES') AS TYPEAFTERSALES,
  JSON_VALUE(PAYLOAD, '$.FABRICATIENUMMER') AS FABRICATIENUMMER,
  JSON_VALUE(PAYLOAD, '$.SLEUTELCONTACT') AS SLEUTELCONTACT,
  JSON_VALUE(PAYLOAD, '$.SLEUTELPORTIER') AS SLEUTELPORTIER,
  JSON_VALUE(PAYLOAD, '$.SLEUTELRESERVOIR') AS SLEUTELRESERVOIR,
  JSON_VALUE(PAYLOAD, '$.CODEAUTORADIO') AS CODEAUTORADIO,
  JSON_VALUE(PAYLOAD, '$.VERSNELLINGSBAKNUMMER') AS VERSNELLINGSBAKNUMMER,
  JSON_VALUE(PAYLOAD, '$.GOEDGEKEURDSAGID') AS GOEDGEKEURDSAGID,
  JSON_VALUE(PAYLOAD, '$.MOTORNUMMER') AS MOTORNUMMER,
  JSON_VALUE(PAYLOAD, '$.AUTOBINNENSAGID') AS AUTOBINNENSAGID,
  JSON_VALUE(PAYLOAD, '$.AFSPRAAKAFLEVERSAGID') AS AFSPRAAKAFLEVERSAGID,
  JSON_VALUE(PAYLOAD, '$.AUTOAFGELEVERDSAGID') AS AUTOAFGELEVERDSAGID,
  JSON_VALUE(PAYLOAD, '$.AUTOVERKOCHTSAGID') AS AUTOVERKOCHTSAGID,
  JSON_VALUE(PAYLOAD, '$.AUTOVERKOCHTDATUM') AS AUTOVERKOCHTDATUM,
  JSON_VALUE(PAYLOAD, '$.AFSPRAAKLEVERINGACTIEID') AS AFSPRAAKLEVERINGACTIEID,
  JSON_VALUE(PAYLOAD, '$.AFLEVERINGMODELID') AS AFLEVERINGMODELID,
  JSON_VALUE(PAYLOAD, '$.AUTOOMSCHRIJVING') AS AUTOOMSCHRIJVING,
  JSON_VALUE(PAYLOAD, '$.AUTOMERKID') AS AUTOMERKID,
  JSON_VALUE(PAYLOAD, '$.DEALERID') AS DEALERID,
  JSON_VALUE(PAYLOAD, '$.PKZM') AS PKZM,
  JSON_VALUE(PAYLOAD, '$.REGISTRATIEDATUM') AS REGISTRATIEDATUM,
  JSON_VALUE(PAYLOAD, '$.AKDHUIDIGMELDING') AS AKDHUIDIGMELDING,
  JSON_VALUE(PAYLOAD, '$.IMPORTMUTATIEDATUM') AS IMPORTMUTATIEDATUM,
  JSON_VALUE(PAYLOAD, '$.NIETAFLEVERENVOOR') AS NIETAFLEVERENVOOR,
  JSON_VALUE(PAYLOAD, '$.INREGISTRATIEBOEK') AS INREGISTRATIEBOEK,
  JSON_VALUE(PAYLOAD, '$.RESERVERINGDATUMBEGIN') AS RESERVERINGDATUMBEGIN,
  JSON_VALUE(PAYLOAD, '$.RESERVERINGDATUMEIND') AS RESERVERINGDATUMEIND,
  JSON_VALUE(PAYLOAD, '$.RESERVERINGGEBRUIKERID') AS RESERVERINGGEBRUIKERID,
  JSON_VALUE(PAYLOAD, '$.EXTKLEUROMSCHRIJVING') AS EXTKLEUROMSCHRIJVING,
  JSON_VALUE(PAYLOAD, '$.INTKLEUROMSCHRIJVING') AS INTKLEUROMSCHRIJVING,
  JSON_VALUE(PAYLOAD, '$.DETAILKLEUROMSCHRIJVING') AS DETAILKLEUROMSCHRIJVING,
  JSON_VALUE(PAYLOAD, '$.DEALERNIETAANPASSEN') AS DEALERNIETAANPASSEN,
  JSON_VALUE(PAYLOAD, '$.INKOPPELSCHERM') AS INKOPPELSCHERM,
  JSON_VALUE(PAYLOAD, '$.ISBETAALDKLANT') AS ISBETAALDKLANT,
  JSON_VALUE(PAYLOAD, '$.ISBETAALDIMPORTEUR') AS ISBETAALDIMPORTEUR,
  JSON_VALUE(PAYLOAD, '$.WERKPLAATSORDERNUMMER') AS WERKPLAATSORDERNUMMER,
  JSON_VALUE(PAYLOAD, '$.FACTUURNRKLANT') AS FACTUURNRKLANT,
  JSON_VALUE(PAYLOAD, '$.FACTUURNRIMPORTEUR') AS FACTUURNRIMPORTEUR,
  JSON_VALUE(PAYLOAD, '$.INORDERRESULTATEN') AS INORDERRESULTATEN,
  JSON_VALUE(PAYLOAD, '$.KENTEKENAANGEVRAAGD') AS KENTEKENAANGEVRAAGD,
  JSON_VALUE(PAYLOAD, '$.SHOWROOMVOORRAAD') AS SHOWROOMVOORRAAD,
  JSON_VALUE(PAYLOAD, '$.OCCASIONID') AS OCCASIONID,
  JSON_VALUE(PAYLOAD, '$.OVERGEDRAGENAAN') AS OVERGEDRAGENAAN,
  JSON_VALUE(PAYLOAD, '$.OVERGEDRAGENDATUM') AS OVERGEDRAGENDATUM,
  JSON_VALUE(PAYLOAD, '$.ISOVERGEDRAGEN') AS ISOVERGEDRAGEN,
  JSON_VALUE(PAYLOAD, '$.WASVOORRAAD') AS WASVOORRAAD,
  JSON_VALUE(PAYLOAD, '$.SOORTLOCATIEID') AS SOORTLOCATIEID,
  JSON_VALUE(PAYLOAD, '$.VOORRAADAUTOID') AS VOORRAADAUTOID,
  JSON_VALUE(PAYLOAD, '$.BESTELDATUM') AS BESTELDATUM,
  JSON_VALUE(PAYLOAD, '$.RENTEDATUM') AS RENTEDATUM,
  JSON_VALUE(PAYLOAD, '$.FACTUURDATUMIMPORTEUR') AS FACTUURDATUMIMPORTEUR,
  JSON_VALUE(PAYLOAD, '$.UITFABRIEKDATUM') AS UITFABRIEKDATUM,
  JSON_VALUE(PAYLOAD, '$.BESTELDDOOR') AS BESTELDDOOR,
  JSON_VALUE(PAYLOAD, '$.NETTOCATPRIJS') AS NETTOCATPRIJS,
  JSON_VALUE(PAYLOAD, '$.AUTOBESTELDSAGID') AS AUTOBESTELDSAGID,
  JSON_VALUE(PAYLOAD, '$.AUTOBESTELDDATUM') AS AUTOBESTELDDATUM,
  JSON_VALUE(PAYLOAD, '$.SOORTKLANTCATEGORIEID') AS SOORTKLANTCATEGORIEID,
  JSON_VALUE(PAYLOAD, '$.RETAILDATUM') AS RETAILDATUM,
  JSON_VALUE(PAYLOAD, '$.REGISTRATIEGEVEND') AS REGISTRATIEGEVEND,
  JSON_VALUE(PAYLOAD, '$.WERKPLAATSDATUM') AS WERKPLAATSDATUM,
  JSON_VALUE(PAYLOAD, '$.AUTORIJKLAAR') AS AUTORIJKLAAR,
  JSON_VALUE(PAYLOAD, '$.REGSELECTIEDATUM') AS REGSELECTIEDATUM, -- belangrijk
  JSON_VALUE(PAYLOAD, '$.KENTEKENBINNEN') AS KENTEKENBINNEN, -- belangrijk
  JSON_VALUE(PAYLOAD, '$.AUTOGEPOETST') AS AUTOGEPOETST,
  JSON_VALUE(PAYLOAD, '$.AFLEVERDEALERID') AS AFLEVERDEALERID,
  JSON_VALUE(PAYLOAD, '$.REGISTRERENVOOR') AS REGISTRERENVOOR,
  JSON_VALUE(PAYLOAD, '$.VTRBEDRAG') AS VTRBEDRAG,
  JSON_VALUE(PAYLOAD, '$.WERKDERDEN') AS WERKDERDEN,
  JSON_VALUE(PAYLOAD, '$.ONDERDELENBESTELD') AS ONDERDELENBESTELD,
  JSON_VALUE(PAYLOAD, '$.BESTELLINGGECONTROLEERD') AS BESTELLINGGECONTROLEERD,
  JSON_VALUE(PAYLOAD, '$.BONUSOPGEVOERD') AS BONUSOPGEVOERD,
  JSON_VALUE(PAYLOAD, '$.OFFERTENUMMER') AS OFFERTENUMMER,
  JSON_VALUE(PAYLOAD, '$.REGISTRATIEDATUMVIARDW') AS REGISTRATIEDATUMVIARDW,
  JSON_VALUE(PAYLOAD, '$.PRODUCTIEDATUM') AS PRODUCTIEDATUM,
  JSON_VALUE(PAYLOAD, '$.PRODUCTIESTATUS') AS PRODUCTIESTATUS,
  JSON_VALUE(PAYLOAD, '$.PRODUCTIESTATUSMUTATIEDATUM') AS PRODUCTIESTATUSMUTATIEDATUM,
  JSON_VALUE(PAYLOAD, '$.FLEETCODE') AS FLEETCODE,
  JSON_VALUE(PAYLOAD, '$.CACHEDINRUILKENTEKEN') AS CACHEDINRUILKENTEKEN,
  JSON_VALUE(PAYLOAD, '$.LEASEORDERNUMMER') AS LEASEORDERNUMMER,
  JSON_VALUE(PAYLOAD, '$.ONDERDELENBINNEN') AS ONDERDELENBINNEN,
  JSON_VALUE(PAYLOAD, '$.FACTUURDATUMKLANT') AS FACTUURDATUMKLANT,
  JSON_VALUE(PAYLOAD, '$.CODESTARTONDERBREKING') AS CODESTARTONDERBREKING,
  JSON_VALUE(PAYLOAD, '$.LUXEKENTEKENPLATEN') AS LUXEKENTEKENPLATEN,
  JSON_VALUE(PAYLOAD, '$.WITTEKENTEKENPLATEN') AS WITTEKENTEKENPLATEN,
  JSON_VALUE(PAYLOAD, '$.FORMULIERID') AS FORMULIERID,
  JSON_VALUE(PAYLOAD, '$.DOCBASEID') AS DOCBASEID,
  JSON_VALUE(PAYLOAD, '$.CALCAFLEVERINGSTATUS') AS CALCAFLEVERINGSTATUS,
  JSON_VALUE(PAYLOAD, '$.OFFERTEID') AS OFFERTEID,
  JSON_VALUE(PAYLOAD, '$.AUTOTYPE') AS AUTOTYPE,
  JSON_VALUE(PAYLOAD, '$.AFGEKEURDDATUM') AS AFGEKEURDDATUM,
  JSON_VALUE(PAYLOAD, '$.LOYALTY_CHASSISNUMMER') AS LOYALTY_CHASSISNUMMER,
  JSON_VALUE(PAYLOAD, '$.LOYALTY_KENTEKEN') AS LOYALTY_KENTEKEN,
  JSON_VALUE(PAYLOAD, '$.LOYALTY_ACTIVE') AS LOYALTY_ACTIVE,
  JSON_VALUE(PAYLOAD, '$.EXTERNID') AS EXTERNID,
  JSON_VALUE(PAYLOAD, '$.HYBRIDELEVEL') AS HYBRIDELEVEL,
  JSON_VALUE(PAYLOAD, '$.CO2UITSTOOT') AS CO2UITSTOOT,
  JSON_VALUE(PAYLOAD, '$.RECYCLINGBIJDRAGECONS') AS RECYCLINGBIJDRAGECONS,
  JSON_VALUE(PAYLOAD, '$.RECYCLINGBIJDRAGEBTW') AS RECYCLINGBIJDRAGEBTW,
  JSON_VALUE(PAYLOAD, '$.PRODUCTIEDATUMVERWACHT') AS PRODUCTIEDATUMVERWACHT,
  JSON_VALUE(PAYLOAD, '$.UITFABRIEKDATUMVERWACHT') AS UITFABRIEKDATUMVERWACHT,
  JSON_VALUE(PAYLOAD, '$.NAARIMPORTEURDATUM') AS NAARIMPORTEURDATUM,
  JSON_VALUE(PAYLOAD, '$.NAARIMPORTEURDATUMVERWACHT') AS NAARIMPORTEURDATUMVERWACHT,
  JSON_VALUE(PAYLOAD, '$.AANKOMSTIMPORTEURDATUM') AS AANKOMSTIMPORTEURDATUM,
  JSON_VALUE(PAYLOAD, '$.AANKOMSTIMPORTEURDATUMVERWACHT') AS AANKOMSTIMPORTEURDATUMVERWACHT,
  JSON_VALUE(PAYLOAD, '$.NAARDEALERDATUM') AS NAARDEALERDATUM,
  JSON_VALUE(PAYLOAD, '$.NAARDEALERDATUMVERWACHT') AS NAARDEALERDATUMVERWACHT,
  JSON_VALUE(PAYLOAD, '$.KENTEKENAANGEVRAAGDDATUM') AS KENTEKENAANGEVRAAGDDATUM,
  JSON_VALUE(PAYLOAD, '$.TRANSPORTMEDIUM') AS TRANSPORTMEDIUM,
  JSON_VALUE(PAYLOAD, '$.PRODUCTIELOCATIE') AS PRODUCTIELOCATIE,
  JSON_VALUE(PAYLOAD, '$.GESCHATAFLEVERJAAR') AS GESCHATAFLEVERJAAR,
  JSON_VALUE(PAYLOAD, '$.NOTARIEELBETALENDOSSIERID') AS NOTARIEELBETALENDOSSIERID,
  JSON_VALUE(PAYLOAD, '$.NOTARIEELBETALENAANMAAKDATUM') AS NOTARIEELBETALENAANMAAKDATUM,
  JSON_VALUE(PAYLOAD, '$.NOTARIEELBETALENBETAALDDATUM') AS NOTARIEELBETALENBETAALDDATUM,
  JSON_VALUE(PAYLOAD, '$.NOTARIEELBETALENVRIJGEEFDATUM') AS NOTARIEELBETALENVRIJGEEFDATUM,
  JSON_VALUE(PAYLOAD, '$.AFLEVERENVOOR') AS AFLEVERENVOOR,
  JSON_VALUE(PAYLOAD, '$.AKDMEMOVERZENDEN') AS AKDMEMOVERZENDEN,
  JSON_VALUE(PAYLOAD, '$.NOTARIEELBETALENBEDRAG') AS NOTARIEELBETALENBEDRAG,
  JSON_VALUE(PAYLOAD, '$.ORDERNUMMERFABRIKANT') AS ORDERNUMMERFABRIKANT,
  JSON_VALUE(PAYLOAD, '$.OTTCODE') AS OTTCODE,
  JSON_VALUE(PAYLOAD, '$.TENAAMSTELLING1') AS TENAAMSTELLING1,
  JSON_VALUE(PAYLOAD, '$.TENAAMSTELLING2') AS TENAAMSTELLING2,
  JSON_VALUE(PAYLOAD, '$.PONKLANTSOORT') AS PONKLANTSOORT,
  JSON_VALUE(PAYLOAD, '$.FOUTMELDINGBESTELSYSTEEM') AS FOUTMELDINGBESTELSYSTEEM,
  JSON_VALUE(PAYLOAD, '$.FOUTBIJBESTELLEN') AS FOUTBIJBESTELLEN,
  JSON_VALUE(PAYLOAD, '$.VERZONDENNAARNIIVOS') AS VERZONDENNAARNIIVOS,
  JSON_VALUE(PAYLOAD, '$.DELYTRANSACTIONID') AS DELYTRANSACTIONID,
  JSON_VALUE(PAYLOAD, '$.CATALOGID') AS CATALOGID,
  JSON_VALUE(PAYLOAD, '$.SOORTDOELSTELLINGID') AS SOORTDOELSTELLINGID,
  JSON_VALUE(PAYLOAD, '$.BESTELJAAR') AS BESTELJAAR,
  JSON_VALUE(PAYLOAD, '$.DTCMEDIA_CRM_ID') AS DTCMEDIA_CRM_ID

FROM (
    SELECT MAX(SCHEMA), PRIMARYFIELDHASH, MAX(PAYLOAD) as PAYLOAD, MAX(ACTION) as ACTION, MAX(RECEIVEDON) as RECEIVEDON
      FROM
         ${ref("samDataProducer_lasttransaction")} as first
         WHERE SCHEMA IN (SELECT schema FROM ${ref("sam_table_hashes")} WHERE tableName = 'AFLEVERING')
         AND RECEIVEDON = (
            SELECT MAX(RECEIVEDON)
            FROM ${ref("samDataProducer_lasttransaction")} as second
            WHERE first.PRIMARYFIELDHASH = second.PRIMARYFIELDHASH and first.SCHEMA = second.SCHEMA)
        GROUP BY PRIMARYFIELDHASH
)

`
let refs = pk.getRefs()
module.exports = {query, refs}
